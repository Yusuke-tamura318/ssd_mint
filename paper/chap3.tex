% !TeX root = paper.tex


\chapter{学習データの準備}\label{genri}
\section{この章で書くこと}
\begin{itemize}
	\item djangoの件
	\item 電車が映っている場面だけ画像で保存
	\item データセットを作成（識別・分類）
	\item アノテーションについて
	\item 
\end{itemize}

\section{画像の収集}
学習データは，ある電車が映っているYouTubeの動画をダウンロードして，任意の枚数だけランダムでフレームを保存する．その後，保存した画像を識別して電車が映っている場面のみ画像で保存をした．
本プロジェクトでは，JR西日本の在来線の電車を識別する．\\
205  207  213  221  223  225  227  271  281  283  285  287  321  323  381  521  683 \\
上記の１７種類の画像を集める
\subsection{動画の保存方法}
動画の保存にはyt-dlpというものを使う．
１〜３種類の動画の任意の秒数をダウンロードしてそれぞれの動画を連結して一つの動画にするwebアプリをpythonのフレームワークの一つであるdjangoを使って作成した．\\
	\red{画像は後で変える，大きさを揃える}\\
	作成したwebアプリは，図\ref{test1} 図\ref{test2}  図\ref{test3}のようになっている．
	YouTube上の動画のURLと開始時刻(秒),終了時刻(秒),車両タイプ名を入力して，1〜3種類の動画を保存し連結して一つの動画にしている．
	
\begin{figure}
	\centering
	\includegraphics [width=\linewidth]{chap3/fig/test1.png}
	\caption{動画のダウンロード1}
	\label{test1}

	
	\includegraphics [width=\linewidth]{chap3/fig/test2.png}
	\caption{動画のダウンロード2}
	\label{test2}
	
	\includegraphics [width=\linewidth]{chap3/fig/test3.png}
	\caption{動画のダウンロード3}
	\label{test3}
\end{figure}

\subsection{画像の保存方法}
画像の保存は二回行う
一回目は，保存した動画でランダムなフレームを保存する．
二回目は，保存した画像を配布されているモデル(yolov8n.pt)で識別をして，電車が一つだけ映っているものだけを保存する．
電車の画像を保存する際には，車両タイプ（数字３桁）というディレクトリに\\
車両タイプ（数字３桁）＿通し番号（数字４桁）.jpg    という名前で保存する
\section{データセットの作成}
\subsection{データセットの構造}
識別モデルと分類モデルでは学習時に使用するデータセットの構造がことなる．また識別モデル用のデータセットには画像のアノテーション情報が必要となる．
\subsection{アノテーション}
%https://www.dir.co.jp/world/entry/solution/annotation
アノテーションとは、機械学習の分類の一つである教師あり学習において,分析対象データにラベルを付与するプロセスである.画像にバウンディングボックスと呼ばれる四角形を描画しクラス番号を指定する．バウンディングボックスを描画することでその画像に写っている物体の座標情報を取得することができる．クラス番号とは，判別したいものリストを作成し，画像に写っている物体に対応した，リストのインデックスのことである．アノテーションをした結果は，識別モデルの学習時に使用する.\\
一般的にアノテーションは，手作業で行うものである．
しかし，数千枚の画像を手作業で行うことは難しいので，自動で行えるようにした．
分類モデル用のデータセットでは一枚の画像に電車が一つだけ映っている．その画像を配布されている識別用モデルで識別することでクラス番号と電車が映っている座標情報をテキストに書き込む．その後，本プロジェクトで識別する車両タイプリストに対応するクラス番号を上書きすることで，分類モデル用のデータセットから識別モデル用のデータセットを作成した．


